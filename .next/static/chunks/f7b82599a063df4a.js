(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,s)=>{t.exports=e.r(76562)},49855,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566);let l=["PROPOSAL_TO_BE_DEVELOPED","PROPOSAL_IN_PROGRESS","PROPOSAL_READY_FOR_FORMATTING","PROPOSAL_SENT"];function r(){var e;let r=(0,a.useParams)().id,[o,d]=(0,s.useState)(null),[n,i]=(0,s.useState)(!0),[c,x]=(0,s.useState)(null),[m,u]=(0,s.useState)(!1),[h,p]=(0,s.useState)({status:"DRAFT",docUrl:"",notes:""}),[b,g]=(0,s.useState)(null),[y,j]=(0,s.useState)(!1);async function N(){try{i(!0);let e=await fetch(`/api/contacts/${r}`);if(!e.ok)throw Error("Failed to fetch contact");let t=await e.json();d(t)}catch(e){x(e instanceof Error?e.message:"Unknown error")}finally{i(!1)}}async function v(){if(o){j(!0);try{if(!(await fetch("/api/proposals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactId:o.id,status:h.status,docUrl:h.docUrl||void 0,notes:h.notes||void 0,ownerUserId:o.proposalOwnerUserId||void 0})})).ok)throw Error("Failed to create proposal");p({status:"DRAFT",docUrl:"",notes:""}),u(!1),await N()}catch(e){alert(e instanceof Error?e.message:"Failed to create proposal")}finally{j(!1)}}}async function f(){if(b){j(!0);try{if(!(await fetch(`/api/proposals/${b.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:h.status,docUrl:h.docUrl||void 0,notes:h.notes||void 0})})).ok)throw Error("Failed to update proposal");p({status:"DRAFT",docUrl:"",notes:""}),g(null),u(!1),await N()}catch(e){alert(e instanceof Error?e.message:"Failed to update proposal")}finally{j(!1)}}}if((0,s.useEffect)(()=>{N()},[r]),n)return(0,t.jsx)("div",{className:"p-8",children:"Loading contact..."});if(c||!o)return(0,t.jsxs)("div",{className:"p-8 text-red-600",children:["Error: ",c||"Contact not found"]});let w=o.displayName||`${o.firstName||""} ${o.lastName||""}`.trim()||"Unknown Contact";return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:w}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 space-y-1",children:[o.email&&(0,t.jsxs)("div",{children:["Email: ",o.email]}),o.phone&&(0,t.jsxs)("div",{children:["Phone: ",o.phone]}),(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:o.stage.replace(/_/g," ")})})]})]}),(e=o.stage,l.includes(e)&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Proposals"}),0===o.proposals.length&&!m&&(0,t.jsx)("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Create Proposal"})]}),o.proposals.length>0&&(0,t.jsx)("div",{className:"space-y-4 mb-4",children:o.proposals.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium ${"ACCEPTED"===e.status?"bg-green-100 text-green-800":"DECLINED"===e.status?"bg-red-100 text-red-800":"SENT"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:e.status})}),(0,t.jsx)("button",{onClick:()=>{g(e),p({status:e.status,docUrl:e.docUrl||"",notes:e.notes||""}),u(!0)},className:"text-blue-600 hover:text-blue-800 text-sm",children:"Edit"})]}),e.docUrl&&(0,t.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:(0,t.jsx)("a",{href:e.docUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"View Document"})}),e.notes&&(0,t.jsx)("div",{className:"text-sm text-gray-700",children:e.notes}),e.owner&&(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["Owner: ",e.owner.displayName||e.owner.email]})]},e.id))}),m&&(0,t.jsxs)("div",{className:"border border-gray-300 rounded p-4 bg-gray-50",children:[(0,t.jsx)("h3",{className:"font-semibold mb-4",children:b?"Update Proposal":"Create New Proposal"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,t.jsxs)("select",{value:h.status,onChange:e=>p({...h,status:e.target.value}),className:"w-full border border-gray-300 rounded px-3 py-2",children:[(0,t.jsx)("option",{value:"DRAFT",children:"Draft"}),(0,t.jsx)("option",{value:"READY",children:"Ready"}),(0,t.jsx)("option",{value:"SENT",children:"Sent"}),(0,t.jsx)("option",{value:"ACCEPTED",children:"Accepted"}),(0,t.jsx)("option",{value:"DECLINED",children:"Declined"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Document URL (optional)"}),(0,t.jsx)("input",{type:"url",value:h.docUrl,onChange:e=>p({...h,docUrl:e.target.value}),placeholder:"https://...",className:"w-full border border-gray-300 rounded px-3 py-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),(0,t.jsx)("textarea",{value:h.notes,onChange:e=>p({...h,notes:e.target.value}),rows:3,className:"w-full border border-gray-300 rounded px-3 py-2"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:b?f:v,disabled:y,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-gray-400",children:y?"Saving...":b?"Update":"Create"}),(0,t.jsx)("button",{onClick:()=>{u(!1),g(null),p({status:"DRAFT",docUrl:"",notes:""})},className:"px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300",children:"Cancel"})]})]})]})]})),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Tasks"}),0===o.tasks.length?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"No tasks yet."}):(0,t.jsx)("div",{className:"space-y-2",children:o.tasks.map(e=>(0,t.jsx)("div",{className:"border border-gray-200 rounded p-3 flex justify-between items-center",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.title}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.status," • ",e.priority,e.dueAt&&` • Due: ${new Date(e.dueAt).toLocaleDateString()}`]})]})},e.id))})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Activity Log"}),0===o.activities.length?(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"No activities yet."}):(0,t.jsx)("div",{className:"space-y-3",children:o.activities.map(e=>(0,t.jsxs)("div",{className:"border-l-4 border-blue-500 pl-4 py-2",children:[(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[new Date(e.occurredAt).toLocaleString()," • ",e.type.replace(/_/g," ")]}),e.subject&&(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.subject}),e.body&&(0,t.jsx)("div",{className:"text-sm text-gray-700 mt-1",children:e.body})]},e.id))})]})]})})}e.s(["default",()=>r])}]);